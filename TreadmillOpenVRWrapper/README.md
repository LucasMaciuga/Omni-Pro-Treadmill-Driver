# TreadmillOpenVRWrapper

OpenVR API Wrapper für Omni Pro Treadmill Input-Injection in VR-Spiele.

## Funktionsweise

Diese DLL ersetzt die `openvr_api.dll` eines Spiels und leitet alle OpenVR-Aufrufe an die echte DLL weiter. Bei Input-Abfragen werden die Treadmill-Daten injiziert.

```
???????????????????????????????????????????????????????????????????????????????
?  VR SPIEL (SkyrimVR, Fallout 4 VR, etc.)                                   ?
?  Lädt: openvr_api.dll (UNSERE WRAPPER-DLL)                                 ?
???????????????????????????????????????????????????????????????????????????????
                             ?
                             ?
???????????????????????????????????????????????????????????????????????????????
?  TreadmillOpenVRWrapper (openvr_api.dll)                                   ?
?  ??? Lädt openvr_api_original.dll                                          ?
?  ??? Leitet alle Calls durch                                               ?
?  ??? Intercepts IVRInput::GetAnalogActionData()                           ?
?  ??? Injiziert Treadmill X/Y in Bewegungs-Actions                         ?
???????????????????????????????????????????????????????????????????????????????
                             ?
                             ?
???????????????????????????????????????????????????????????????????????????????
?  openvr_api_original.dll (echte OpenVR-DLL)                                ?
?  ? Kommuniziert mit SteamVR                                                ?
???????????????????????????????????????????????????????????????????????????????
```

## Installation

### Für SkyrimVR (mit MGON/VRIK)

1. Navigiere zum SkyrimVR-Ordner:
   ```
   C:\Program Files (x86)\Steam\steamapps\common\SkyrimVR\
   ```

2. **Sichere** die originale `openvr_api.dll`:
   ```
   ren openvr_api.dll openvr_api_original.dll
   ```

3. Kopiere diese Dateien in den Ordner:
   - `openvr_api.dll` (unsere Wrapper-DLL)
   - `OmniBridge.dll`
   - `treadmill_config.json`

4. Bearbeite `treadmill_config.json` und setze den richtigen COM-Port

5. Starte SkyrimVR über SKSE

### Für andere Spiele

1. Finde das Spielverzeichnis mit `openvr_api.dll`
2. Führe die gleichen Schritte wie oben aus

## Konfiguration

Bearbeite `treadmill_config.json`:

```json
{
    "enabled": true,
    "comPort": "COM3",
    "speedMultiplier": 1.5,
    "deadzone": 0.1,
    "smoothing": 0.3,
    "inputMode": "smart",
    "actionPatterns": ["*move*", "*locomotion*"],
    "debugLog": true
}
```

### Input-Modi

- **override**: Treadmill ersetzt Controller-Input
- **additive**: Treadmill + Controller werden kombiniert
- **smart**: Treadmill überschreibt nur wenn aktiv (empfohlen)

## Unterstützte Spiele

| Spiel | Status | Hinweise |
|-------|--------|----------|
| SkyrimVR | ? | Funktioniert mit MGON/VRIK |
| Fallout 4 VR | ? | Getestet |
| Boneworks | ?? | Sollte funktionieren |
| H3VR | ?? | Sollte funktionieren |
| Blade & Sorcery (alt) | ?? | Alte Versionen nutzen OpenVR |

## Debugging

Das Log wird in `treadmill_wrapper.log` im Spielordner geschrieben.

Wichtige Log-Einträge:
```
[OK] Loaded openvr_api_original.dll
[OK] Treadmill connected successfully!
[OK] Detected movement action: /actions/gameplay/in/Move
[OK] Injected treadmill into action: X=0.500 Y=0.750
```

## Deinstallation

1. Lösche `openvr_api.dll` (unsere Wrapper-DLL)
2. Benenne `openvr_api_original.dll` zurück zu `openvr_api.dll`
3. Lösche `OmniBridge.dll` und `treadmill_config.json`

## Build

Benötigt:
- Visual Studio 2022
- Windows SDK 10.0
- C++20

```bash
# In Visual Studio
# Öffne TreadmillOpenVRWrapper.sln
# Build -> Build Solution (x64 Release)
```

## Dateien

| Datei | Beschreibung |
|-------|--------------|
| `dllmain.cpp` | DLL Entry, OpenVR-Funktionen exportieren |
| `openvr_wrapper.h/cpp` | IVRInput Wrapping, Action-Interception |
| `treadmill_input.h/cpp` | OmniBridge-Integration, State-Management |
| `treadmill_config.json` | Konfigurationsdatei |
